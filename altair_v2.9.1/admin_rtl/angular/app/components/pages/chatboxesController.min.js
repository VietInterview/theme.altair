angular.module("altairApp").controller("chatboxesCtrl",["$scope","$rootScope","$timeout","utils",function($scope,$rootScope,$timeout,utils){$rootScope.secondarySidebarPersistent=!0,$rootScope.secondarySidebarActive=!0,$scope.$on("$destroy",function(){$rootScope.secondarySidebarPersistent=!1,$rootScope.secondarySidebarActive=!1});var $chatbox_wrapper=$("#chatbox_wrapper");$chatbox_wrapper.on("mousewheel DOMMouseScroll",".chatbox_content",function(e){var e0=e.originalEvent,delta=e0.wheelDelta||-e0.detail;this.scrollTop+=30*(delta<0?1:-1),e.preventDefault()}),$scope.chat_users=[{id:1,name:"Asia Kovacek",avatar:"assets/img/avatars/avatar_04_tn.png",status:"online",info:"Non tenetur atque eius",conversation:[{messages:[{time:1473940165e3,text:"lorem ipsum dolor sit amet..."},{time:1473940165e3,text:"Enim, est, quasi. Accusamus adipisci consequuntur exercitationem inventore itaque"}]},{own:!0,messages:[{time:1473940165e3,text:"Accusamus adipisci consequuntur exercitationem inventore itaque"},{time:1473940165e3,text:"consequuntur exercitationem inventore itaque"},{time:1473940165e3,text:"Lorem ipsum dolor sit amet, consectetur adipisicing elit."}]}]},{id:2,name:"Max Bernhard",avatar:"assets/img/avatars/avatar_05_tn.png",status:"offline",info:"Repudiandae aperiam et consequunt",conversation:[{own:!0,messages:[{time:1473940165e3,text:"Accusamus adipisci consequuntur exercitationem inventore itaque"}]},{messages:[{time:1473940165e3,text:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Enim, est, quasi. Accusamus adipisci consequuntur exercitationem inventore itaque"},{time:1473940165e3,text:"Enim, est, quasi. Accusamus adipisci consequuntur exercitationem inventore itaque"}]}]},{id:3,name:"Gabriella Emard",avatar:"assets/img/avatars/avatar_08_tn.png",status:"busy",info:"Officiis et fugiat reiciendis ut",conversation:[{messages:[{time:1473940165e3,text:"lorem ipsum dolor sit amet..."},{time:1473940165e3,text:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Enim, est, quasi. Accusamus adipisci consequuntur exercitationem inventore itaque"}]},{own:!0,messages:[{time:1473940165e3,text:"Lorem ipsum dolor sit amet, consectetur adipisicing elit."}]}]},{id:4,name:"Opal Swaniawski",avatar:"assets/img/avatars/avatar_07_tn.png",status:"online",info:"Nihil animi nulla ea",conversation:[{messages:[{time:1473940165e3,text:"lorem ipsum dolor sit amet..."},{time:1473940165e3,text:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Enim, est, quasi. Accusamus adipisci consequuntur exercitationem inventore itaque"},{time:1473940165e3,text:"Enim, est, quasi. Accusamus adipisci consequuntur exercitationem inventore itaque"}]},{own:!0,messages:[{time:1473940165e3,text:"Accusamus adipisci consequuntur exercitationem inventore itaque"},{time:1473940165e3,text:"consequuntur exercitationem inventore itaque"},{time:1473940165e3,text:"Lorem ipsum dolor sit amet, consectetur adipisicing elit."}]}]},{id:5,name:"Morton Hammes",avatar:"assets/img/avatars/avatar_09_tn.png",status:"online",info:"Unde assumenda voluptatem",conversation:[{messages:[{time:1473940165e3,text:"lorem ipsum dolor sit amet..."},{time:1473940165e3,text:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Enim, est, quasi. Accusamus adipisci consequuntur exercitationem inventore itaque"},{time:1473940165e3,text:"Enim, est, quasi. Accusamus adipisci consequuntur exercitationem inventore itaque"}]},{own:!0,messages:[{time:1473940165e3,text:"Accusamus adipisci consequuntur exercitationem inventore itaque"},{time:1473940165e3,text:"consequuntur exercitationem inventore itaque"},{time:1473940165e3,text:"Lorem ipsum dolor sit amet, consectetur adipisicing elit."}]}]}],$scope.startChat=function($event,id){$event.preventDefault(),$scope.activeUser=utils.findById($scope.chat_users,id),$scope.activeUser.active||($scope.activeUser.active=!0,$scope.makeActive(null,id))},$scope.makeActive=function($event,id){if($chatbox_wrapper.find(".cb_active").removeClass("cb_active"),$event){if($event.preventDefault(),$($event.target).closest(".chatbox_close").length)return;$($event.currentTarget).addClass("cb_active").find(".message_input").focus()}else $timeout(function(){var $chatbox=$chatbox_wrapper.find('.chatbox[data-id="'+id+'"]');$chatbox.addClass("cb_active").find(".message_input").focus();var $chatbox_content=$chatbox.find(".chatbox_content");$chatbox_content.scrollTop($chatbox_content[0].scrollHeight)})},$(document).on("click",function(e){$(e.target).closest(".chatbox").length||$chatbox_wrapper.find(".cb_active").removeClass("cb_active")}),$scope.closeChatbox=function($event,id){$event.preventDefault(),$($event.target).closest(".chatbox").addClass("removing"),$scope.activeUser=utils.findById($scope.chat_users,id),$timeout(function(){delete $scope.activeUser.active},280)},$scope.sendMessage=function($event,id,index){$event.preventDefault(),$scope.activeUser=utils.findById($scope.chat_users,id);var code=$event.keyCode||$event.which,inptVal=$scope.activeUser.inptMessage;if(13==code&&""!=inptVal){var $chatbox=$($event.target).closest(".chatbox"),$chatbox_content=$chatbox.find(".chatbox_content"),conversation=$scope.activeUser.conversation,last_conversation=conversation[conversation.length-1];last_conversation.own?last_conversation.messages.push({text:inptVal,time:(new Date).getTime()}):conversation.push({own:!0,messages:[{text:inptVal,time:(new Date).getTime()}]}),delete $scope.activeUser.inptMessage,$timeout(function(){$chatbox_content.scrollTop($chatbox_content[0].scrollHeight)})}}}]);