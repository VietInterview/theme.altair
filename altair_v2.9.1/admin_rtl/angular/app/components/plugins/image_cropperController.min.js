angular.module("altairApp").controller("image_cropperCtrl",["$scope",function($scope){var console=window.console||{log:function(){}},$image=$("#image_cropper"),$download=$("#image_download"),options={aspectRatio:16/9,preview:".cr_preview"};$image.one("load",function(){$image.on({"build.cropper":function(e){console.log(e.type)},"built.cropper":function(e){console.log(e.type)},"cropstart.cropper":function(e){console.log(e.type,e.action)},"cropmove.cropper":function(e){console.log(e.type,e.action)},"cropend.cropper":function(e){console.log(e.type,e.action)},"crop.cropper":function(e){console.log(e.type,e.x,e.y,e.width,e.height,e.rotate,e.scaleX,e.scaleY)},"zoom.cropper":function(e){console.log(e.type,e.ratio)}}).cropper(options),$.isFunction(document.createElement("canvas").getContext)||$('button[data-method="getCroppedCanvas"]').prop("disabled",!0),"undefined"==typeof document.createElement("cropper").style.transition&&($('button[data-method="rotate"]').prop("disabled",!0),$('button[data-method="scale"]').prop("disabled",!0)),console.log("undefined"==typeof $download[0].download),"undefined"==typeof $download[0].download&&$download.addClass("disabled"),$(".croper-toggles").on("click","button",function(){if($(this).hasClass("uk-active")){var $this=$(this),value=$this.attr("data-value");if(!$image.data("cropper"))return;$image.cropper("setAspectRatio",value)}}),$(".cropper-buttons").on("click","[data-method]",function(){var $target,result,$this=$(this),data=$this.data();if(!$this.prop("disabled")&&!$this.hasClass("disabled")&&$image.data("cropper")&&data.method){if(data=$.extend({},data),"undefined"!=typeof data.target&&($target=$(data.target),"undefined"==typeof data.option))try{data.option=JSON.parse($target.val())}catch(e){console.log(e.message)}switch(result=$image.cropper(data.method,data.option,data.secondOption),data.method){case"scaleX":case"scaleY":$(this).data("option",-data.option);break;case"getCroppedCanvas":if(result){var modalId="#getCroppedCanvasModal",modal=UIkit.modal(modalId);$(modalId).find(".canvasModalImage").html(result),modal.show(),$download.hasClass("disabled")||$download.attr("href",result.toDataURL("image/jpeg"))}}if($.isPlainObject(result)&&$target)try{$target.val(JSON.stringify(result))}catch(e){console.log(e.message)}}}),$(document.body).on("keydown",function(e){if($image.data("cropper")&&!(this.scrollTop>300))switch(e.which){case 37:e.preventDefault(),$image.cropper("move",-1,0);break;case 38:e.preventDefault(),$image.cropper("move",0,-1);break;case 39:e.preventDefault(),$image.cropper("move",1,0);break;case 40:e.preventDefault(),$image.cropper("move",0,1)}});var $imageUrl,blobURL,$inputImage=$("#inputImage"),URL=window.URL||window.webkitURL;URL?$inputImage.change(function(){var file,files=this.files;$image.data("cropper")&&files&&files.length&&(file=files[0],/^image\/\w+$/.test(file.type)?(blobURL=URL.createObjectURL(file),$image.one("built.cropper",function(){URL.revokeObjectURL(blobURL)}).cropper("reset").cropper("replace",blobURL),$inputImage.val(""),$imageUrl=blobURL):window.alert("Please choose an image file."))}):$inputImage.prop("disabled",!0).parent().addClass("disabled")}),$scope.$on("$destroy",function(){$image.cropper("destroy").off("build.cropper built.cropper cropstart.cropper cropmove.cropper cropend.cropper crop.cropper zoom.cropper","**"),$(".croper-toggles").off("click","button"),$(".cropper-buttons").off("click","[data-method]")})}]);