angular.module("altairApp").controller("map_directionsCtrl",["$scope","$timeout",function($scope,$timeout){$scope.drivingMode=!1,$scope.drivingSpeed=50,$scope.driverMode=!1,$scope.origin="1135 Karamea-Kohaihai Rd, Kahurangi National Park, Tasman",$scope.destination="Pier St, Jackson Bay, West Coast, New Zeland";var map,updateFrequency=1e3,savedPath=null,overviewPath=[],overviewPathIndex=0,detailedPath=[],detailedPathIndex=0,directionsService=new google.maps.DirectionsService,driveOverviewPaths=function(){var op1,op2;if(detailedPath.length>detailedPathIndex)driveDetailedPaths();else if(op1=overviewPath[overviewPathIndex],op2=overviewPath[overviewPathIndex+1],overviewPathIndex+=1,op1&&op2){var request={origin:op1,destination:op2,travelMode:"DRIVING"};directionsService.route(request,function(response,status){status==google.maps.DirectionsStatus.OK&&(detailedPath=response.routes[0].overview_path,console.log("Updated detailedPath for overviewpath between",overviewPathIndex,"and",overviewPathIndex+1,"with",detailedPath.length,"geo points"),detailedPathIndex=0,driveOverviewPaths())})}},driveDetailedPaths=function(){var meter=Math.floor(1e3*parseInt($scope.drivingSpeed,10)/3600*(updateFrequency/1e3)),point1=detailedPath[detailedPathIndex],point2=detailedPath[detailedPathIndex+1];if(point1&&point2){var heading=google.maps.geometry.spherical.computeHeading(point1,point2),distance=google.maps.geometry.spherical.computeDistanceBetween(point1,point2),totalCount=parseInt(distance/meter,10)||1,drive=function(count,position){console.log(overviewPathIndex+"/"+overviewPath.length,detailedPathIndex+"/"+detailedPath.length,count+"/"+totalCount,"distance",meter),totalCount>=count?$timeout(function(){var pov=map.getStreetView().getPov();$scope.driverMode&&(map.setHeading(heading),pov.heading=heading),map.getStreetView().setPosition(position),map.getStreetView().setPov(pov),map.getStreetView().setVisible(!0);var distanceToPoint2=google.maps.geometry.spherical.computeDistanceBetween(position,point2),nextPosition=distanceToPoint2<meter?point2:google.maps.geometry.spherical.computeOffset(position,meter,heading);return $scope.drivingMode?void drive(++count,nextPosition):(savedPath={count:count,position:position},!1)},updateFrequency):(detailedPathIndex+=1,$scope.$emit("driveOverviewPath"))},count=savedPath&&savedPath.count||1,position=savedPath&&savedPath.position||point1;savedPath=null,drive(count,position)}else detailedPathIndex+=1,$scope.$emit("driveOverviewPath")};$scope.$on("driveOverviewPath",function(){driveOverviewPaths()}),$scope.drive=function(){$scope.drivingMode=!$scope.drivingMode,$scope.drivingMode&&(map.setZoom(16),savedPath?driveDetailedPaths():$scope.$emit("driveOverviewPath"))},$scope.directionsChanged=function(){overviewPath=this.directions.routes[0].overview_path,console.log("direction is changed","got overviewPath with",overviewPath.length,"points"),map.getStreetView().setPosition(overviewPath[0]),overviewPathIndex=0,detailedPathIndex=0,$scope.drivingMode=!1,toContinue=null},$scope.$on("mapInitialized",function(e,_map_){map=_map_,window.map=map}),$scope.$on("$destroy",function(){$scope.drivingMode=!1})}]).controller("gmap_neutralBlueCtrl",["$scope","$timeout",function($scope,$timeout){}]).controller("gmap_subtleGreyCtrl",["$scope","$timeout",function($scope,$timeout){}]);